<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>주간 시간표 (Weekly Timetable)</title>
<style>
  :root{
    --bg:#fff7fa; /* 연다홍색 계열 연한 배경 */
    --accent:#ffb6cc; /* 연다홍색 */
    --accent-dark:#ff90b4;
    --grid-border:#e9d6df;
    --text:#2b2b2b;
  }
  *{box-sizing:border-box;font-family:Inter, "Noto Sans KR", system-ui, sans-serif}
  body{margin:0;background:var(--bg);color:var(--text);padding:18px;}
  h1{margin:0 0 12px;font-size:20px}
  .timetable-wrap{max-width:1100px;margin:0 auto;background:white;border-radius:12px;padding:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .controls{display:flex;gap:8px;align-items:center;margin-bottom:10px}
  .btn{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  .btn.secondary{background:#fff;border:1px solid var(--grid-border)}
  .grid{
    display:grid;
    grid-template-columns:60px repeat(7,1fr);
    border:1px solid var(--grid-border);
    border-radius:8px;
    overflow:hidden;
  }
  .time-col{background:#fff;border-right:1px solid var(--grid-border);}
  .time-cell{height:48px;display:flex;align-items:center;justify-content:center;font-size:12px;border-bottom:1px dashed var(--grid-border)}
  .day-header{
    height:48px;display:flex;align-items:center;justify-content:center;font-weight:700;border-bottom:1px solid var(--grid-border);
    background:linear-gradient(0deg, #fff, #fff);
  }
  .day-col{min-height:480px;border-right:1px solid var(--grid-border);position:relative}
  .slot{height:48px;border-bottom:1px dashed var(--grid-border);cursor:pointer}
  .day-col:last-child{border-right:0}
  /* 이벤트 스타일 */
  .event{
    position:absolute;
    left:6px;right:6px;
    background:linear-gradient(180deg,var(--accent),var(--accent-dark));
    color:#3b0616;padding:6px;border-radius:8px;font-size:12px;font-weight:700;
    box-shadow:0 4px 10px rgba(255, 92, 150, 0.12);
    cursor:grab;
  }
  .event.dragging{opacity:0.85;cursor:grabbing}
  /* 모바일 축소 */
  @media (max-width:700px){
    .grid{grid-template-columns:50px repeat(7, minmax(70px,1fr));}
    .time-cell,.day-header{font-size:11px}
    .event{font-size:11px}
  }
  .hint{font-size:12px;color:#6b6b6b;margin-left:auto}
</style>
</head>
<body>
  <div class="timetable-wrap">
    <div style="display:flex;align-items:center;">
      <h1>주간 시간표</h1>
      <div class="hint">셀 클릭→이벤트 추가 • 이벤트 클릭→삭제키(DEL)</div>
    </div>

    <div class="controls">
      <button id="add-sample" class="btn">샘플 추가</button>
      <button id="clear" class="btn secondary">모두 삭제</button>
      <div style="margin-left:auto;font-size:13px;color:#666">시간단위: 1칸 = 1시간 (08:00 ~ 20:00)</div>
    </div>

    <div class="grid" id="grid">
      <!-- 첫 열: 시간 -->
      <div class="time-col">
        <div class="day-header">시간</div>
        <!-- time cells -->
      </div>

      <!-- 일요일~토요일 아닌 월~일 표시: 월~일 -->
      <!-- 요일 헤더 -->
      <div class="day-header">월</div>
      <div class="day-header">화</div>
      <div class="day-header">수</div>
      <div class="day-header">목</div>
      <div class="day-header">금</div>
      <div class="day-header">토</div>
      <div class="day-header">일</div>

      <!-- 시간 칸들 및 day cols -->
    </div>
  </div>

<script>
(() => {
  const START_H = 8;
  const END_H = 25; // exclusive end (08..19 slot height) but we show up to 20:00 label
  const HOURS = Array.from({length: END_H - START_H + 1}, (_,i) => START_H + i); // include END_H for label

  const grid = document.getElementById('grid');

  // 시간 칸 채우기 (첫 열)
  const timeCol = grid.querySelector('.time-col');
  // header already present, append time cells for each hour slot (08~19)
  for(let h = START_H; h < END_H; h++){
    const div = document.createElement('div');
    div.className = 'time-cell';
    div.textContent = `${String(h).padStart(2,'0')}:00`;
    timeCol.appendChild(div);
  }

  // create day columns (7 days), each with slots equal to (END_H - START_H)
  const dayNames = ['mon','tue','wed','thu','fri','sat','sun'];
  const dayCols = [];
  for(let d=0; d<7; d++){
    const col = document.createElement('div');
    col.className = 'day-col';
    col.dataset.day = dayNames[d];
    // create slots
    for(let h = START_H; h < END_H; h++){
      const slot = document.createElement('div');
      slot.className = 'slot';
      slot.dataset.hour = h;
      // 클릭하면 새 이벤트 생성
      slot.addEventListener('click', (e) => {
        // prevent creating when clicking an existing event (bubbled)
        if(e.target !== slot) return;
        const title = prompt('이벤트 제목을 입력하세요 (예: 수학)');
        if(!title) return;
        createEvent(col.dataset.day, h, 1, title);
      });
      col.appendChild(slot);
    }
    // dragover allow for drop
    col.addEventListener('dragover', (ev) => { ev.preventDefault(); });
    grid.appendChild(col);
    dayCols.push(col);
  }

  // 데이터 구조: 이벤트들을 메모리로 보관 (간단)
  let events = [];
  let nextId = 1;

  // 이벤트 생성 함수
  function createEvent(day, startHour, durationHours = 1, title = '이벤트'){
    const id = nextId++;
    const ev = {id, day, startHour, durationHours, title};
    events.push(ev);
    renderEvent(ev);
  }

  // 렌더링
  function renderEvent(ev){
    // remove if exists
    const existing = document.querySelector(`.event[data-id="${ev.id}"]`);
    if(existing) existing.remove();

    const dayCol = dayCols[['mon','tue','wed','thu','fri','sat','sun'].indexOf(ev.day)];
    if(!dayCol) return;
    const slotHeight = dayCol.querySelector('.slot').offsetHeight || 48;
    const top = (ev.startHour - START_H) * slotHeight + 2; // spacing
    const height = Math.max(36, ev.durationHours * slotHeight - 6);

    const el = document.createElement('div');
    el.className = 'event';
    el.draggable = true;
    el.dataset.id = ev.id;
    el.style.top = top + 'px';
    el.style.height = height + 'px';
    el.innerText = ev.title + `\n${String(ev.startHour).padStart(2,'0')}:00`;
    // event handlers for drag
    el.addEventListener('dragstart', dragStart);
    el.addEventListener('dragend', dragEnd);
    // click to select for deletion
    el.addEventListener('click', (e)=>{
      e.stopPropagation();
      // toggle selection
      document.querySelectorAll('.event').forEach(x=>x.classList.remove('selected'));
      el.classList.add('selected');
    });

    dayCol.appendChild(el);
  }

  // drag handlers
  let dragging = null;
  let offsetY = 0;
  function dragStart(e){
    const id = Number(e.target.dataset.id);
    dragging = events.find(x=>x.id===id);
    e.dataTransfer.setData('text/plain', id);
    e.dataTransfer.effectAllowed = 'move';
    e.target.classList.add('dragging');
    // calculate offset within element
    const rect = e.target.getBoundingClientRect();
    offsetY = e.clientY - rect.top;
  }
  function dragEnd(e){
    const el = e.target;
    el.classList.remove('dragging');

    // find which column (day) we dropped into and compute hour
    const x = e.clientX;
    const y = e.clientY;
    const targetCol = dayCols.find(col => {
      const r = col.getBoundingClientRect();
      return x >= r.left && x <= r.right && y >= r.top && y <= r.bottom;
    });
    if(!targetCol){
      dragging = null;
      return;
    }
    const r = targetCol.getBoundingClientRect();
    const relY = y - r.top - offsetY + 4; // adjust
    const slotHeight = targetCol.querySelector('.slot').offsetHeight || 48;
    let newStart = Math.round(relY / slotHeight) + START_H;
    if(newStart < START_H) newStart = START_H;
    if(newStart >= END_H) newStart = END_H - 1;
    // update model
    dragging.day = targetCol.dataset.day;
    dragging.startHour = newStart;
    // re-render all
    rerenderAll();
    dragging = null;
  }

  function rerenderAll(){
    // remove all DOM events
    document.querySelectorAll('.event').forEach(x=>x.remove());
    // render in order
    events.forEach(renderEvent);
  }

  // keyboard delete to remove selected
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Delete'){
      const sel = document.querySelector('.event.selected');
      if(sel){
        const id = Number(sel.dataset.id);
        events = events.filter(x=>x.id !== id);
        sel.remove();
      }
    }
  });

  // controls: 샘플 추가
  document.getElementById('add-sample').addEventListener('click', ()=>{
    createEvent('mon',9,2,'수학');
    createEvent('wed',11,1,'영어');
    createEvent('fri',14,3,'프로그래밍');
  });

  document.getElementById('clear').addEventListener('click', ()=>{
    if(confirm('모든 이벤트를 삭제할까요?')) {
      events = [];
      rerenderAll();
    }
  });

  // 간단한 초기 샘플
  // createEvent('mon',10,2,'샘플');
})();
</script>
</body>
</html>
